<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/CadastroCliente.css" />
  <title>Cadastro de Cliente | TaskUP</title>
   <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-masker/1.1.0/vanilla-masker.min.js"></script>
</head>
<body>

  <!-- TOPO DO SITE -->
   <div class="topo">
    <div class="topo-conteudo">
        <div class="logo">
          <img src="img/icone.png" alt="Logo da TaskUp" class="logo-img">
          <h1>TaskUp</h1>
        </div>
    <nav class="menu">
     <a href="inicial.html">Início</a>
          <a href="cadastroPeca.html">Cadastrar Peça</a>
          <a href="cadastroAparelho.html">Cadastrar Aparelho</a>
          <a href="cadastroCliente.html">Cadastrar Cliente</a>
          <a href="tabelas.html">Tabelas</a>
          <a href="agenda.html">Agenda</a>
    </nav>
    <div class="usuario">Olá, Técnico</div>
  </div>
  </div>

  <!-- CONTAINER PRINCIPAL -->
  <div class="container">
    <h1>Cadastro de Cliente</h1>
    <p class="description">Preencher corretamente todos os campos do cliente <span class="required">*</span></p>

    <!-- Tipo de Pessoa -->
    <div class="client-type">
      <label>
        <input type="radio" name="tipo" value="pf" checked />
        Pessoa Física
      </label>
      <label>
        <input type="radio" name="tipo" value="pj" />
        Pessoa Jurídica
      </label>
    </div>

    <!-- Documento + Buscar -->
    <div class="doc-search">
      <div class="input-group">
        <label for="cpfCnpj" id="cpfCnpjLabel">CPF <span class="required">*</span></label>
        <input type="text" id="cpfCnpj" placeholder="Insira o CPF" required />
      </div>
      <button type="button" id="buscarBtn" class="submit-btn" style="width: auto; padding: 10px 20px; font-size: 14px;">Buscar Cliente</button>
    </div>

    <!-- Status da busca -->
    <p id="statusBusca" style="margin-top: 10px;"></p>

    <!-- Formulário de Cliente -->
    <form id="clienteForm">
      <div class="form-grid">

        <!-- Pessoa Física -->
        <div id="nomePessoaFisica">
          <div class="input-group">
            <label for="nomeCompleto">Nome Completo <span class="required">*</span></label>
            <input type="text" id="nomeCompleto" required />
          </div>
        </div>

        <!-- Pessoa Jurídica -->
        <div id="nomePessoaJuridica" style="display: none;" class="full-width">
          <div class="input-group">
            <label for="nomeEmpresa">Nome da Empresa <span class="required">*</span></label>
            <input type="text" id="nomeEmpresa" required />
          </div>
        </div>

        <div class="input-group">
          <label for="telefone">Telefone <span class="required">*</span></label>
          <input type="tel" id="telefone" placeholder="(DDD) Telefone" required />
        </div>

        <div class="input-group">
          <label for="email">E-mail <span class="required">*</span></label>
          <input type="email" id="email" required />
        </div>

        <div class="input-group">
          <label for="cep">CEP <span class="required">*</span></label>
          <input type="text" id="cep" required />
        </div>

        <div class="input-group full-width">
          <label for="endereco">Endereço</label>
          <input type="text" id="endereco" />
        </div>

        <div class="input-group">
          <label for="bairro">Bairro <span class="required">*</span></label>
          <input type="text" id="bairro" required />
        </div>

        <div class="input-group">
          <label for="cidade">Cidade <span class="required">*</span></label>
          <input type="text" id="cidade" required />
        </div>

        <div class="input-group">
          <label for="estado">Estado <span class="required">*</span></label>
          <input type="text" id="estado" required />
        </div>
      </div>

      <button type="submit" class="submit-btn">Cadastrar Cliente</button>
    </form>
  </div>
  <!-- Script para alternar Pessoa Física / Jurídica e aplicar máscaras -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const radioPF = document.querySelector('input[value="pf"]');
      const radioPJ = document.querySelector('input[value="pj"]');
      const docLabel = document.getElementById('cpfCnpjLabel');
      const docInput = document.getElementById('cpfCnpj');
      const nomePF = document.getElementById('nomePessoaFisica');
      const nomePJ = document.getElementById('nomePessoaJuridica');
      const telefoneInput = document.getElementById('telefone');
      const cepInput = document.getElementById('cep');
      
      // Função para alternar entre Pessoa Física e Pessoa Jurídica
      function updateDocField() {
        if (radioPF.checked) {
          docLabel.textContent = 'CPF *';
          docInput.placeholder = 'Insira o CPF';
          nomePF.style.display = 'block';
          nomePJ.style.display = 'none';
          VMasker(docInput).maskPattern('999.999.999-99'); // Formata CPF
        } else {
          docLabel.textContent = 'CNPJ *';
          docInput.placeholder = 'Insira o CNPJ';
          nomePF.style.display = 'none';
          nomePJ.style.display = 'block';
          VMasker(docInput).maskPattern('99.999.999/9999-99'); // Formata CNPJ
        }
      }

      // Máscara de Telefone
      VMasker(telefoneInput).maskPattern('(99) 9 9999-9999');

      // Máscara de CEP
      VMasker(cepInput).maskPattern('99999-999');

      // Iniciar a alternância de CPF/CNPJ
      radioPF.addEventListener('change', updateDocField);
      radioPJ.addEventListener('change', updateDocField);
      updateDocField(); // Inicialização

      // Função para validar o formulário antes do envio
      const form = document.getElementById('clienteForm');
      form.addEventListener('submit', function(event) {
        let valid = true;
        // Verificar se o CPF/CNPJ está preenchido corretamente
        if (!docInput.value) {
          valid = false;
          alert("Por favor, insira um CPF ou CNPJ.");
        }

        // Verificar se os campos obrigatórios estão preenchidos
        form.querySelectorAll('input[required], textarea[required]').forEach(input => {
          if (!input.value) {
            valid = false;
            alert(`Por favor, preencha o campo ${input.previousElementSibling.textContent.trim()}`);
          }
        });

        if (!valid) {
          event.preventDefault(); // Impede o envio do formulário se houver erros
        }
      });

      // Quando o formulário for enviado
      form.addEventListener('submit', async function(event) {
        event.preventDefault(); // Evitar o envio padrão do formulário
        
        // Coletar os dados do formulário
        const formData = new FormData(this);  
        try {
          // Enviar os dados para a API (backend)
          
      const response = await fetch('http://localhost:8080/api/cliente', {
            method: 'POST',
            body: formData // Envia o formulário como FormData, permitindo envio de arquivos
          });

          // Verificar se a resposta foi bem-sucedida
          const result = await response.json();  // A resposta da API será no formato JSON

          if (response.ok) {
            alert('Cliente cadastrado com sucesso!');  // Mensagem de sucesso
            this.reset();  // Limpar o formulário após o envio
          } else {
            alert(`Erro: ${result.message}`);  // Mensagem de erro com base na resposta da API
          }
        } catch (error) {
          // Exibir erro caso algo falhe na requisição
          console.error('Erro ao tentar cadastrar o cliente:', error);
          alert('Ocorreu um erro ao tentar salvar o cliente. Tente novamente mais tarde.');
        }
      });
    });
  </script>
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="JavaScript/custom-alerts.js"></script>
</body>
</html>
<script src="JavaScript/CadastroCliente.js"></script>